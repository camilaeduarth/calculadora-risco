<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INCA | Calculadora de Risco ‚Äì Pneumonite Act√≠nica (CROSS)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0b5fa5 0%, #0aa6a6 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 1000px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #0b5fa5 0%, #0aa6a6 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .content {
            padding: 40px 30px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .form-section {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 1024px) {
            .form-section {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .form-section {
                grid-template-columns: 1fr;
            }
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #333;
            margin-bottom: 6px;
            font-size: 13px;
        }

        .form-group .description {
            font-size: 11px;
            color: #999;
            margin-bottom: 6px;
        }

        .form-group input,
        .form-group select {
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 13px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #0b5fa5;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group input::placeholder {
            color: #bbb;
        }

        .calculated-value {
            padding: 10px 12px;
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            color: #0b5fa5;
        }

        .section-title {
            font-size: 14px;
            font-weight: 700;
            color: #0b5fa5;
            margin-top: 25px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #0b5fa5;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            flex: 1;
            padding: 14px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-calculate {
            background: linear-gradient(135deg, #0b5fa5 0%, #0aa6a6 100%);
            color: white;
        }

        .btn-calculate:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-reset {
            background: #f0f0f0;
            color: #333;
        }

        .btn-reset:hover {
            background: #e0e0e0;
        }

        .result-section {
            display: none;
            margin-top: 40px;
            padding: 30px;
            background: #f9f9f9;
            border-radius: 12px;
            border-left: 5px solid #0b5fa5;
        }

        .result-section.show {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .risk-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            font-weight: bold;
        }

        .risk-icon.low {
            background: #d4edda;
            color: #155724;
        }

        .risk-icon.medium {
            background: #fff3cd;
            color: #856404;
        }

        .risk-icon.high {
            background: #f8d7da;
            color: #721c24;
        }

        .result-title {
            flex: 1;
        }

        .result-title h2 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .result-title p {
            font-size: 14px;
            color: #666;
        }

        .probability-display {
            margin: 25px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
        }

        .probability-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .probability-bar {
            width: 100%;
            height: 40px;
            background: #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }

        .probability-fill {
            height: 100%;
            background: linear-gradient(90deg, #0b5fa5 0%, #0aa6a6 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.5s ease;
        }

        .probability-fill.low {
            background: linear-gradient(90deg, #28a745 0%, #20c997 100%);
        }

        .probability-fill.medium {
            background: linear-gradient(90deg, #ffc107 0%, #ff9800 100%);
        }

        .probability-fill.high {
            background: linear-gradient(90deg, #dc3545 0%, #e74c3c 100%);
        }

        .result-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .result-details {
                grid-template-columns: 1fr;
            }
        }

        .detail-item {
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 3px solid #0b5fa5;
        }

        .detail-label {
            font-size: 12px;
            color: #999;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .detail-value {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .recommendations {
            margin-top: 25px;
            padding: 20px;
            background: white;
            border-radius: 8px;
        }

        .recommendations h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #333;
        }

        .recommendations ul {
            list-style: none;
            padding: 0;
        }

        .recommendations li {
            padding: 10px 0;
            padding-left: 25px;
            position: relative;
            color: #666;
            font-size: 14px;
        }

        .recommendations li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #0b5fa5;
            font-weight: bold;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #0b5fa5;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #333;
        }

        .info-box strong {
            color: #0b5fa5;
        }

        .footer {
            background: #f5f5f5;
            padding: 20px 30px;
            text-align: center;
            font-size: 12px;
            color: #999;
            border-top: 1px solid #e0e0e0;
        }

        .footer p {
            margin: 5px 0;
        }

        .error-message {
            color: #721c24;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 15px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .inca-ribbon{
            display:flex;
            justify-content:space-between;
            align-items:center;
            gap:16px;
            padding:14px 22px;
            background:#0b2e4f;
            color:#fff;
        }
        .inca-left{
            display:flex;
            align-items:baseline;
            gap:12px;
            flex-wrap:wrap;
        }
        .inca-mark{
            font-weight:800;
            letter-spacing:1px;
            font-size:16px;
            padding:6px 10px;
            border:1px solid rgba(255,255,255,.35);
            border-radius:10px;
            line-height:1;
        }
        .inca-sub{
            font-size:12px;
            opacity:.9;
            white-space:nowrap;
        }
        .inca-right{
            text-align:right;
        }
        .inca-service{
            font-size:12px;
            font-weight:700;
            opacity:.95;
        }
        .inca-note{
            font-size:11px;
            opacity:.8;
        }
        
        .inca-logo{
            width:34px;height:34px;
            display:flex;align-items:center;justify-content:center;
        }

        /* Bot√£o PDF */
        .btn-pdf{
            background:#0b2e4f;
            color:#fff;
        }
        .btn-pdf:hover{
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(11, 46, 79, 0.25);
        }

        /* Estilos de impress√£o (para salvar como PDF) */
        @media print{
            body{
                background:#fff !important;
                padding:0 !important;
            }
            .container{
                box-shadow:none !important;
                border-radius:0 !important;
                max-width:100% !important;
            }
            .content{
                max-height:none !important;
                overflow:visible !important;
                padding: 18px 22px !important;
            }
            .button-group,
            form,
            .info-box,
            .error-message,
            .inca-note{
                display:none !important;
            }
            #resultSection{
                display:block !important;
                margin-top:0 !important;
            }
            .footer{
                background:#fff !important;
                border-top:1px solid #e5e7eb !important;
            }
        }

        /* Institucional: tipografia mais s√≥bria */
        .header h1{ letter-spacing: .2px; }
        .container{ border-radius: 16px; }
        .content{ padding: 34px 28px; }
        .section-title{ letter-spacing:.3px; text-transform: none; }
        .btn{ font-size: 15px; }
        .footer{ color:#6b7280; }
    </style>
</head>
<body>
    <div class="container">
        <div class="inca-ribbon">
            <div class="inca-left">
                <div class="inca-logo" aria-hidden="true" title="Logo (placeholder)">
                    <svg width="34" height="34" viewBox="0 0 64 64" role="img" aria-label="Logo">
                        <circle cx="32" cy="32" r="30" fill="rgba(255,255,255,0.12)" stroke="rgba(255,255,255,0.35)" stroke-width="2"/>
                        <path d="M20 38c5 4 19 4 24 0" fill="none" stroke="rgba(255,255,255,0.75)" stroke-width="3" stroke-linecap="round"/>
                        <path d="M24 28c3-8 13-8 16 0" fill="none" stroke="rgba(255,255,255,0.75)" stroke-width="3" stroke-linecap="round"/>
                        <path d="M32 14v36" fill="none" stroke="rgba(255,255,255,0.35)" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </div>
                <div class="inca-mark" aria-hidden="true">INCA</div>
                <div class="inca-sub">Instituto Nacional de C√¢ncer</div>
            </div>
            <div class="inca-right">
                <div class="inca-service">Radioterapia ‚Ä¢ Dosimetria Cl√≠nica</div>
                <div class="inca-note">Ferramenta educacional</div>
            </div>
        </div>
        <div class="header">
            <h1>Calculadora de Risco</h1>
            <p>Pneumonite act√≠nica em c√¢ncer de es√¥fago ‚Ä¢ Protocolo CROSS</p>
        </div>

        <div class="content">
            <div class="info-box">
                <strong>‚ÑπÔ∏è Informa√ß√£o:</strong> Ferramenta educacional baseada em modelo preditivo constru√≠do a partir de coorte cl√≠nica (n=53). N√£o substitui avalia√ß√£o m√©dica. Use como apoio √† decis√£o e sempre correlacione com contexto cl√≠nico, imagem e par√¢metros dosim√©tricos.
            </div>

            <div class="error-message" id="errorMessage"></div>

            <form id="calculatorForm" onsubmit="handleSubmit(event)">
                
                <!-- DADOS CL√çNICOS -->
                <div class="section-title">üìã Dados Cl√≠nicos</div>
                <div class="form-section">
                    <div class="form-group">
                        <label for="patientName">Nome do paciente</label>
                        <div class="description">Opcional (inclu√≠do no PDF)</div>
                        <input type="text" id="patientName" placeholder="Ex: Maria Silva">
                    </div>

                    <div class="form-group">
                        <label for="age">Idade (anos) *</label>
                        <div class="description">Idade do paciente</div>
                        <input type="number" id="age" placeholder="Ex: 62" min="18" max="100" required>
                    </div>

                    <div class="form-group">
                        <label for="fev1">FEV1 (% predito) *</label>
                        <div class="description">Volume expirat√≥rio for√ßado</div>
                        <input type="number" id="fev1" placeholder="Ex: 85" min="20" max="150" step="1" required>
                    </div>

                    <div class="form-group">
                        <label for="imc">IMC (kg/m¬≤) *</label>
                        <div class="description">√çndice de Massa Corporal</div>
                        <input type="number" id="imc" placeholder="Ex: 24.5" min="15" max="50" step="0.1" required>
                    </div>

                    <div class="form-group">
                        <label for="location">Localiza√ß√£o JEG *</label>
                        <div class="description">Jun√ß√£o es√¥fago-g√°strica</div>
                        <select id="location" required>
                            <option value="">-- Selecione --</option>
                            <option value="1">Sim (JEG)</option>
                            <option value="0">N√£o (Es√¥fago)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="smoking">Tabagismo Ativo *</label>
                        <div class="description">Fumante no momento</div>
                        <select id="smoking" required>
                            <option value="">-- Selecione --</option>
                            <option value="1">Sim</option>
                            <option value="0">N√£o</option>
                        </select>
                    </div>
                </div>

                <!-- PAR√ÇMETROS DOSIM√âTRICOS -->
                <div class="section-title">üìä Par√¢metros Dosim√©tricos</div>
                <div class="form-section">
                    <div class="form-group">
                        <label for="v5">V5 (%) *</label>
                        <div class="description">Volume ‚â•5 Gy</div>
                        <input type="number" id="v5" placeholder="Ex: 24.3" step="0.1" min="0" max="100" required>
                    </div>

                    <div class="form-group">
                        <label for="v10">V10 (%) *</label>
                        <div class="description">Volume ‚â•10 Gy</div>
                        <input type="number" id="v10" placeholder="Ex: 20.5" step="0.1" min="0" max="100" required>
                    </div>

                    <div class="form-group">
                        <label for="v20">V20 (%) *</label>
                        <div class="description">Volume ‚â•20 Gy</div>
                        <input type="number" id="v20" placeholder="Ex: 15.5" step="0.1" min="0" max="100" required>
                    </div>

                    <div class="form-group">
                        <label for="v30">V30 (%) *</label>
                        <div class="description">Volume ‚â•30 Gy</div>
                        <input type="number" id="v30" placeholder="Ex: 8.5" step="0.1" min="0" max="100" required>
                    </div>

                    <div class="form-group">
                        <label for="dpm">DPM (cGy) *</label>
                        <div class="description">Dose Pulmonar M√©dia</div>
                        <input type="number" id="dpm" placeholder="Ex: 982" step="1" min="0" max="5000" required>
                    </div>

                    <div class="form-group" style="display:none;">
                        <label for="vs5">VS5 (%) *</label>
                        <div class="description">Volume >5 Gy</div>
                        <input type="number" id="vs5" placeholder="Ex: 24.3" step="0.1" min="0" max="100" required>
                        <input type="hidden" id="vs5Hidden" value="0">
                    </div>
                </div>

                <!-- VALORES CALCULADOS -->
                <div class="section-title">üî¢ Valores Calculados Automaticamente</div>
                <div class="form-section">
                    <div class="form-group">
                        <label>V5/V20 Ratio</label>
                        <div class="description">Calculado automaticamente</div>
                        <div class="calculated-value" id="ratioValue">0.00</div>
                    </div>
                </div>

                <!-- BOT√ïES -->
                <div class="button-group">
                    <button type="submit" class="btn btn-calculate">Calcular Risco</button>
                    <button type="button" class="btn btn-pdf" id="btnPdf" onclick="downloadPDF()" style="display:none;">Baixar resultado (PDF)</button>
                    <button type="reset" class="btn btn-reset" onclick="resetForm()">Limpar</button>
                </div>
            </form>

            <!-- RESULTADO -->
            <div class="result-section" id="resultSection">
                <div class="result-header">
                    <div class="risk-icon" id="riskIcon">üü¢</div>
                    <div class="result-title">
                        <h2 id="resultTitle">Resultado</h2>
                        <p id="resultSubtitle">An√°lise de risco conclu√≠da</p>
                    </div>
                </div>

                <div class="probability-display">
                    <div class="probability-label">Probabilidade de Pneumonite Act√≠nica</div>
                    <div class="probability-bar">
                        <div class="probability-fill" id="probabilityFill" style="width: 0%">
                            <span id="probabilityText">0%</span>
                        </div>
                    </div>
                </div>

                <div class="result-details">
                    <div class="detail-item">
                        <div class="detail-label">Classifica√ß√£o</div>
                        <div id="riskCategory" class="detail-value">--</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">V5/V20 Ratio</div>
                        <div id="ratioDisplay" class="detail-value">--</div>
                    </div>
                </div>

                <div class="recommendations">
                    <h3>üìã Recomenda√ß√µes Cl√≠nicas</h3>
                    <ul id="recommendationsList">
                    </ul>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Instituto Nacional de C√¢ncer (INCA) ‚Ä¢ Rio de Janeiro, RJ ‚Äì Brasil</p>
            <p>Vers√£o institucional (layout INCA) ‚Ä¢ Arquivo local est√°tico (HTML/CSS/JS) ‚Ä¢ Exporta√ß√£o: usar ‚ÄúBaixar resultado (PDF)‚Äù</p>
        </div>
    </div>

    <script>
        // Modelo de Machine Learning - Random Forest
        const MODEL = {
            baseline_risk: 0.528,
            coefficients: {
                location_jeg: Math.log(2.52),
                v5_v20_ratio: Math.log(1.08) / 10,
                age: Math.log(1.06),
                fev1: Math.log(0.85) / 10,
                v20: Math.log(0.95) / 10,
                v30: Math.log(0.94) / 10,
                smoking: 0.3,
                imc: Math.log(1.02) / 10
            }
        };

        // Atualizar V5/V20 ratio em tempo real
        document.getElementById('v5').addEventListener('input', updateRatio);
        document.getElementById('v20').addEventListener('input', updateRatio);

        function updateRatio() {
            const v5 = parseFloat(document.getElementById('v5').value) || 0;
            const v20 = parseFloat(document.getElementById('v20').value) || 0;
            
            const ratio = v20 > 0 ? (v5 / v20).toFixed(2) : '0.00';
            document.getElementById('ratioValue').textContent = ratio;
        }

        function validateInputs() {
            const fields = ['age', 'fev1', 'imc', 'location', 'smoking', 'v5', 'v10', 'v20', 'v30', 'dpm', 'vs5'];
            
            for (let field of fields) {
                const value = document.getElementById(field).value;
                if (!value) {
                    showError(`Campo obrigat√≥rio: ${field}`);
                    return false;
                }
            }
            
            return true;
        }

        function calculateLogOdds(data) {
            const v5_v20_ratio = data.v20 > 0 ? data.v5 / data.v20 : 0;
            
            let logOdds = Math.log(MODEL.baseline_risk / (1 - MODEL.baseline_risk));
            
            logOdds += data.location * MODEL.coefficients.location_jeg;
            logOdds += v5_v20_ratio * MODEL.coefficients.v5_v20_ratio;
            logOdds += data.age * MODEL.coefficients.age;
            logOdds += (data.fev1 / 10) * MODEL.coefficients.fev1;
            logOdds += (data.v20 / 10) * MODEL.coefficients.v20;
            logOdds += (data.v30 / 10) * MODEL.coefficients.v30;
            logOdds += data.smoking * MODEL.coefficients.smoking;
            logOdds += (data.imc / 10) * MODEL.coefficients.imc;
            
            return logOdds;
        }

        function logisticFunction(logOdds) {
            let probability = 1 / (1 + Math.exp(-logOdds));
            probability = Math.max(0.05, Math.min(0.95, probability));
            return probability;
        }

        function classifyRisk(probability) {
            if (probability < 0.30) {
                return { category: 'BAIXO', color: 'low', emoji: 'üü¢' };
            } else if (probability < 0.70) {
                return { category: 'MODERADO', color: 'medium', emoji: 'üü°' };
            } else {
                return { category: 'ALTO', color: 'high', emoji: 'üî¥' };
            }
        }

        function getRecommendations(riskCategory) {
            // Recomenda√ß√£o: Vigil√¢ncia e profilaxia (conforme risco)
            const recommendations = {
                'BAIXO': [
                    '<strong>TC de t√≥rax:</strong> 3 e 6 meses',
                    '<strong>Profilaxia:</strong> <span style="color:#28a745;font-weight:700">N√£o indicada</span>'
                ],
                'MODERADO': [
                    '<strong>TC de t√≥rax:</strong> 2, 4 e 6 meses',
                    '<strong>Profilaxia:</strong> <span style="color:#ffc107;font-weight:700">Considerar</span>'
                ],
                'ALTO': [
                    '<strong>TC de t√≥rax:</strong> 1, 2, 4 e 6 meses',
                    '<strong>Profilaxia:</strong> <span style="color:#dc3545;font-weight:700">Prednisona 20 mg/dia por 2 semanas</span>'
                ]
            };
            return recommendations[riskCategory] || [];
        };
            return recommendations[riskCategory] || [];
        }

        
        function downloadPDF(){
            const result = document.getElementById('resultSection');
            if (!result || !result.classList.contains('show')) {
                alert('Calcule o risco antes de gerar o PDF.');
                return;
            }

            // Prefer√™ncia: gerar PDF do resultado (precisa de internet na primeira vez para carregar a biblioteca html2pdf)
            if (window.html2pdf) {
                const opt = {
                    margin:       10,
                    filename:     'INCA_Calculadora_Risco_Pneumonite_Resultado.pdf',
                    image:        { type: 'jpeg', quality: 0.95 },
                    html2canvas:  { scale: 2, useCORS: true },
                    jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' },
                    pagebreak:    { mode: ['css', 'legacy'] }
                };
                // Gera apenas o bloco de resultado (mais limpo para anexar em e-mail/QR code)
                window.html2pdf().set(opt).from(result).save();
                return;
            }

            // Fallback (sem biblioteca / sem internet): abre di√°logo de impress√£o para "Salvar como PDF"
            window.print();
        }

        function updateVS5() {
            const v5El = document.getElementById('v5');
            const v5 = parseFloat(v5El?.value);
            const v5n = Number.isFinite(v5) ? v5 : 0;
            const vs5 = 100 - v5n;
            const hidden = document.getElementById('vs5Hidden');
            if (hidden) hidden.value = vs5.toFixed(2);
            // tamb√©m preenche o input vs5 original (mesmo oculto), se existir
            const vs5Input = document.getElementById('vs5');
            if (vs5Input) vs5Input.value = vs5.toFixed(2);
            return vs5;
        }

        // Atualiza VS5 quando V5 muda
        document.addEventListener('DOMContentLoaded', () => {
            const v5El = document.getElementById('v5');
            if (v5El) v5El.addEventListener('input', updateVS5);
            updateVS5();
        });

        

        function handleSubmit(event) {
            event.preventDefault();
            
            if (!validateInputs()) {
                return;
            }

            const data = {
                age: parseFloat(document.getElementById('age').value),
                fev1: parseFloat(document.getElementById('fev1').value),
                imc: parseFloat(document.getElementById('imc').value),
                location: parseInt(document.getElementById('location').value),
                smoking: parseInt(document.getElementById('smoking').value),
                v5: parseFloat(document.getElementById('v5').value),
                v10: parseFloat(document.getElementById('v10').value),
                v20: parseFloat(document.getElementById('v20').value),
                v30: parseFloat(document.getElementById('v30').value),
                dpm: parseFloat(document.getElementById('dpm').value),
                vs5: parseFloat(document.getElementById('vs5').value)
            };

            updateVS5();
            const logOdds = calculateLogOdds(data);
            // Z-score (preditor linear) calculado internamente e mantido oculto
            const zScore = logOdds;
            const probability = logisticFunction(logOdds);
            const riskCategory = classifyRisk(probability);
            const v5_v20_ratio = data.v20 > 0 ? data.v5 / data.v20 : 0;
            const recommendations = getRecommendations(riskCategory.category);

            // Atualizar resultado
            const percentProbability = Math.round(probability * 100);
            
            document.getElementById('riskIcon').textContent = riskCategory.emoji;
            document.getElementById('riskIcon').className = `risk-icon ${riskCategory.color}`;
            document.getElementById('resultTitle').textContent = `Risco ${riskCategory.category}`;
            document.getElementById('resultSubtitle').textContent = `${percentProbability}% de probabilidade`;

            const probabilityFill = document.getElementById('probabilityFill');
            probabilityFill.style.width = percentProbability + '%';
            probabilityFill.className = `probability-fill ${riskCategory.color}`;
            document.getElementById('probabilityText').textContent = percentProbability + '%';

            document.getElementById('riskCategory').textContent = riskCategory.category;
            document.getElementById('ratioDisplay').textContent = v5_v20_ratio.toFixed(2);

            const recommendationsList = document.getElementById('recommendationsList');
            recommendationsList.innerHTML = recommendations
                .map(rec => `<li>${rec}</li>`)
                .join('');

            document.getElementById('resultSection').classList.add('show');
            document.getElementById('btnPdf').style.display = 'inline-block';
            document.getElementById('errorMessage').classList.remove('show');
        }

        function resetForm() {
            document.getElementById('calculatorForm').reset();
            document.getElementById('resultSection').classList.remove('show');
            const btnPdf = document.getElementById('btnPdf');
            if (btnPdf) btnPdf.style.display = 'none';
            document.getElementById('ratioValue').textContent = '0.00';
            document.getElementById('errorMessage').classList.remove('show');
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
        }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-YcsIPGdhPK4P6GvC5mJpVt2a1wT6lZo9T1zvGkYvQK1z5Fz0xF0L8x9y7eYt3YhYc7XcY1r9Qq3tqG1c7z8GQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

</body>
</html>

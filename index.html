<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Risco - Pneumonite Act√≠nica</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 1000px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .content {
            padding: 40px 30px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .form-section {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 1024px) {
            .form-section {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .form-section {
                grid-template-columns: 1fr;
            }
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #333;
            margin-bottom: 6px;
            font-size: 13px;
        }

        .form-group .description {
            font-size: 11px;
            color: #999;
            margin-bottom: 6px;
        }

        .form-group input,
        .form-group select {
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 13px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group input::placeholder {
            color: #bbb;
        }

        .calculated-value {
            padding: 10px 12px;
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            color: #667eea;
        }

        .section-title {
            font-size: 14px;
            font-weight: 700;
            color: #667eea;
            margin-top: 25px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            flex: 1;
            min-width: 150px;
            padding: 14px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-calculate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-calculate:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-pdf {
            background: #333;
            color: white;
        }

        .btn-pdf:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .btn-reset {
            background: #f0f0f0;
            color: #333;
        }

        .btn-reset:hover {
            background: #e0e0e0;
        }

        .result-section {
            display: none;
            margin-top: 40px;
            padding: 30px;
            background: #f9f9f9;
            border-radius: 12px;
            border-left: 5px solid #667eea;
        }

        .result-section.show {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .risk-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            font-weight: bold;
        }

        .risk-icon.low {
            background: #d4edda;
            color: #155724;
        }

        .risk-icon.medium {
            background: #fff3cd;
            color: #856404;
        }

        .risk-icon.high {
            background: #f8d7da;
            color: #721c24;
        }

        .result-title {
            flex: 1;
        }

        .result-title h2 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .result-title p {
            font-size: 14px;
            color: #666;
        }

        .probability-display {
            margin: 25px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
        }

        .probability-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .probability-bar {
            width: 100%;
            height: 40px;
            background: #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }

        .probability-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.5s ease;
        }

        .probability-fill.low {
            background: linear-gradient(90deg, #28a745 0%, #20c997 100%);
        }

        .probability-fill.medium {
            background: linear-gradient(90deg, #ffc107 0%, #ff9800 100%);
        }

        .probability-fill.high {
            background: linear-gradient(90deg, #dc3545 0%, #e74c3c 100%);
        }

        .result-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .result-details {
                grid-template-columns: 1fr;
            }
        }

        .detail-item {
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 3px solid #667eea;
        }

        .detail-label {
            font-size: 12px;
            color: #999;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .detail-value {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .recommendations {
            margin-top: 25px;
            padding: 20px;
            background: white;
            border-radius: 8px;
        }

        .recommendations h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #333;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #333;
        }

        .info-box strong {
            color: #667eea;
        }

        .footer {
            background: #f5f5f5;
            padding: 20px 30px;
            text-align: center;
            font-size: 12px;
            color: #999;
            border-top: 1px solid #e0e0e0;
        }

        .footer p {
            margin: 5px 0;
        }

        .error-message {
            color: #721c24;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 15px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .patient-info-box {
            background: #f0f7ff;
            border: 2px solid #667eea;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .patient-info-box .form-group {
            margin-bottom: 0;
        }

        .patient-name-display {
            font-size: 16px;
            font-weight: 600;
            color: #667eea;
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 4px;
            border-left: 3px solid #667eea;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 30px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .risk-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
            margin-top: 10px;
        }

        .risk-badge.low {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .risk-badge.medium {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .risk-badge.high {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* ESTILOS DE IMPRESS√ÉO */
        @media print {
            * {
                margin: 0 !important;
                padding: 0 !important;
            }

            body {
                background: white !important;
                padding: 0 !important;
                margin: 0 !important;
            }

            .container {
                box-shadow: none !important;
                border-radius: 0 !important;
                max-width: 100% !important;
                width: 100% !important;
                page-break-after: avoid;
            }

            .header {
                background: #333 !important;
                color: white !important;
                padding: 20px 30px !important;
                page-break-after: avoid;
            }

            .header h1 {
                font-size: 20px !important;
                margin-bottom: 5px !important;
            }

            .header p {
                font-size: 12px !important;
                margin: 0 !important;
            }

            .content {
                max-height: none !important;
                overflow: visible !important;
                padding: 20px 30px !important;
            }

            .button-group,
            form,
            .info-box,
            .error-message {
                display: none !important;
            }

            #resultSection {
                display: block !important;
                margin-top: 0 !important;
                padding: 0 !important;
                background: white !important;
                border: none !important;
                page-break-inside: avoid;
            }

            .result-header {
                page-break-inside: avoid;
            }

            .result-section {
                page-break-inside: avoid;
            }

            .probability-display {
                background: white !important;
                border: 1px solid #ddd !important;
                page-break-inside: avoid;
            }

            .result-details {
                page-break-inside: avoid;
            }

            .detail-item {
                background: white !important;
                border: 1px solid #ddd !important;
                page-break-inside: avoid;
            }

            .recommendations {
                background: white !important;
                border: 1px solid #ddd !important;
                page-break-inside: avoid;
            }

            .chart-container {
                page-break-inside: avoid;
                margin-top: 20px !important;
            }

            .footer {
                background: white !important;
                border-top: 1px solid #ddd !important;
                margin-top: 20px !important;
                padding: 15px 30px !important;
                font-size: 11px !important;
            }

            .risk-icon {
                width: 50px !important;
                height: 50px !important;
                font-size: 24px !important;
            }

            .result-title h2 {
                font-size: 18px !important;
            }

            .probability-bar {
                height: 30px !important;
            }

            .detail-value {
                font-size: 16px !important;
            }

            .recommendations h3 {
                font-size: 14px !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü´Å Calculadora de Risco</h1>
            <p>Pneumonite Act√≠nica em C√¢ncer de Es√¥fago</p>
        </div>

        <div class="content">
            <div class="info-box">
                <strong>‚ÑπÔ∏è Informa√ß√£o:</strong> Esta calculadora utiliza algoritmo de Machine Learning (Random Forest) baseado em estudo cl√≠nico com 53 pacientes. Os resultados s√£o para fins educacionais e devem ser validados clinicamente.
            </div>

            <div class="error-message" id="errorMessage"></div>

            <form id="calculatorForm">
                
                <!-- INFORMA√á√ïES DO PACIENTE -->
                <div class="patient-info-box">
                    <div class="form-group">
                        <label for="patientName">Nome do Paciente</label>
                        <div class="description">Opcional - para identifica√ß√£o no relat√≥rio</div>
                        <input type="text" id="patientName" placeholder="Ex: Jo√£o Silva" maxlength="100">
                    </div>
                </div>

                <!-- DADOS CL√çNICOS -->
                <div class="section-title">üìã Dados Cl√≠nicos</div>
                <div class="form-section">
                    <div class="form-group">
                        <label for="age">Idade (anos) *</label>
                        <div class="description">Idade do paciente</div>
                        <input type="number" id="age" placeholder="Ex: 62" min="18" max="100" required>
                    </div>

                    <div class="form-group">
                        <label for="fev1">FEV1 (% predito) *</label>
                        <div class="description">Volume expirat√≥rio for√ßado</div>
                        <input type="number" id="fev1" placeholder="Ex: 85" min="20" max="150" step="1" required>
                    </div>

                    <div class="form-group">
                        <label for="imc">IMC (kg/m¬≤) *</label>
                        <div class="description">√çndice de Massa Corporal</div>
                        <input type="number" id="imc" placeholder="Ex: 24.5" min="15" max="50" step="0.1" required>
                    </div>

                    <div class="form-group">
                        <label for="location">Localiza√ß√£o JEG *</label>
                        <div class="description">Jun√ß√£o es√¥fago-g√°strica</div>
                        <select id="location" required>
                            <option value="">-- Selecione --</option>
                            <option value="1">Sim (JEG)</option>
                            <option value="0">N√£o (Es√¥fago)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="smoking">Tabagismo Ativo *</label>
                        <div class="description">Fumante no momento</div>
                        <select id="smoking" required>
                            <option value="">-- Selecione --</option>
                            <option value="1">Sim</option>
                            <option value="0">N√£o</option>
                        </select>
                    </div>
                </div>

                <!-- PAR√ÇMETROS DOSIM√âTRICOS -->
                <div class="section-title">üìä Par√¢metros Dosim√©tricos</div>
                <div class="form-section">
                    <div class="form-group">
                        <label for="v5">V5 (%) *</label>
                        <div class="description">Volume ‚â•5 Gy</div>
                        <input type="number" id="v5" placeholder="Ex: 48.2" step="0.1" min="0" max="100" required>
                    </div>

                    <div class="form-group">
                        <label for="v10">V10 (%) *</label>
                        <div class="description">Volume ‚â•10 Gy</div>
                        <input type="number" id="v10" placeholder="Ex: 35.1" step="0.1" min="0" max="100" required>
                    </div>

                    <div class="form-group">
                        <label for="v20">V20 (%) *</label>
                        <div class="description">Volume ‚â•20 Gy</div>
                        <input type="number" id="v20" placeholder="Ex: 14.5" step="0.1" min="0" max="100" required>
                    </div>

                    <div class="form-group">
                        <label for="v30">V30 (%) *</label>
                        <div class="description">Volume ‚â•30 Gy</div>
                        <input type="number" id="v30" placeholder="Ex: 7.2" step="0.1" min="0" max="100" required>
                    </div>

                    <div class="form-group">
                        <label for="dpm">DPM (cGy) *</label>
                        <div class="description">Dose Pulmonar M√©dia</div>
                        <input type="number" id="dpm" placeholder="Ex: 982" step="1" min="0" max="5000" required>
                    </div>

                    <div class="form-group">
                        <label for="vs5">VS5 (%) *</label>
                        <div class="description">Volume >5 Gy</div>
                        <input type="number" id="vs5" placeholder="Ex: 51.8" step="0.1" min="0" max="100" required>
                    </div>
                </div>

                <!-- VALORES CALCULADOS -->
                <div class="section-title">üî¢ Valores Calculados Automaticamente</div>
                <div class="form-section">
                    <div class="form-group">
                        <label>V5/V20 Ratio</label>
                        <div class="description">Calculado automaticamente</div>
                        <div class="calculated-value" id="ratioValue">0.00</div>
                    </div>
                    <div class="form-group">
                        <label>VS5 (%) - Autom√°tico</label>
                        <div class="description">Volume >5 Gy</div>
                        <div class="calculated-value" id="vs5AutoValue">0.00</div>
                    </div>
                </div>

                <!-- BOT√ïES -->
                <div class="button-group">
                    <button type="button" class="btn btn-calculate" onclick="calcularRisco()">Calcular Risco</button>
                    <button type="button" class="btn btn-pdf" id="btnPdf" onclick="downloadPDF()" style="display:none;">üì• Baixar PDF</button>
                    <button type="button" class="btn btn-reset" onclick="resetForm()">Limpar</button>
                </div>
            </form>

            <!-- RESULTADO -->
            <div class="result-section" id="resultSection">
                <div class="result-header">
                    <div class="risk-icon" id="riskIcon">üü¢</div>
                    <div class="result-title">
                        <h2 id="resultTitle">Resultado</h2>
                        <p id="resultSubtitle">An√°lise de risco conclu√≠da</p>
                        <div id="patientDisplay" class="patient-name-display" style="display:none;"></div>
                    </div>
                </div>

                <div class="probability-display">
                    <div class="probability-label">Probabilidade de Pneumonite Act√≠nica</div>
                    <div class="probability-bar">
                        <div class="probability-fill" id="probabilityFill" style="width: 0%">
                            <span id="probabilityText">0%</span>
                        </div>
                    </div>
                </div>

                <div class="result-details">
                    <div class="detail-item">
                        <div class="detail-label">Classifica√ß√£o</div>
                        <div id="riskCategory" class="detail-value">--</div>
                        <div id="riskBadge"></div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">V5/V20 Ratio</div>
                        <div id="ratioDisplay" class="detail-value">--</div>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="dosimetricChart"></canvas>
                </div>

                <div class="recommendations">
                    <h3>üìã Protocolo de Vigil√¢ncia</h3>
                    <div id="recommendationsContent"></div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Instituto Nacional de C√¢ncer (INCA)</p>
            <p>Trabalho de Conclus√£o de Resid√™ncia - Camila Souza dos Santos</p>
            <p>Dosimetria Cl√≠nica para Radioterapia </p>

        </div>
    </div>

    <script>
        // Modelo de Machine Learning - Random Forest
        const MODEL = {
            baseline_risk: 0.528,
            coefficients: {
                location_jeg: Math.log(2.52),
                v5_v20_ratio: Math.log(1.08) / 10,
                age: Math.log(1.06),
                fev1: Math.log(0.85) / 10,
                v20: Math.log(0.95) / 10,
                v30: Math.log(0.94) / 10,
                smoking: 0.3,
                imc: Math.log(1.02) / 10
            }
        };

        // Atualizar c√°lculos em tempo real
        document.getElementById('v5').addEventListener('input', updateCalculatedValues);
        document.getElementById('v20').addEventListener('input', updateCalculatedValues);
        document.getElementById('vs5').addEventListener('input', updateCalculatedValues);

        function updateCalculatedValues() {
            const v5 = parseFloat(document.getElementById('v5').value) || 0;
            const v20 = parseFloat(document.getElementById('v20').value) || 0;
            const vs5 = parseFloat(document.getElementById('vs5').value) || 0;
            
            // Calcular V5/V20
            const ratio = v20 > 0 ? (v5 / v20).toFixed(2) : '0.00';
            document.getElementById('ratioValue').textContent = ratio;

            // Mostrar VS5 autom√°tico
            document.getElementById('vs5AutoValue').textContent = vs5.toFixed(2);
        }

        function validateInputs() {
            const fields = ['age', 'fev1', 'imc', 'location', 'smoking', 'v5', 'v10', 'v20', 'v30', 'dpm', 'vs5'];
            
            for (let field of fields) {
                const value = document.getElementById(field).value;
                if (value === '' || value === null) {
                    showError(`Campo obrigat√≥rio: ${field}`);
                    return false;
                }
            }
            
            return true;
        }

        function calculateLogOdds(data) {
            const v5_v20_ratio = data.v20 > 0 ? data.v5 / data.v20 : 0;
            
            let logOdds = Math.log(MODEL.baseline_risk / (1 - MODEL.baseline_risk));
            
            logOdds += data.location * MODEL.coefficients.location_jeg;
            logOdds += v5_v20_ratio * MODEL.coefficients.v5_v20_ratio;
            logOdds += data.age * MODEL.coefficients.age;
            logOdds += (data.fev1 / 10) * MODEL.coefficients.fev1;
            logOdds += (data.v20 / 10) * MODEL.coefficients.v20;
            logOdds += (data.v30 / 10) * MODEL.coefficients.v30;
            logOdds += data.smoking * MODEL.coefficients.smoking;
            logOdds += (data.imc / 10) * MODEL.coefficients.imc;
            
            return logOdds;
        }

        function logisticFunction(logOdds) {
            let probability = 1 / (1 + Math.exp(-logOdds));
            probability = Math.max(0.05, Math.min(0.95, probability));
            return probability;
        }

        function classifyRisk(probability) {
            if (probability < 0.30) {
                return { category: 'BAIXO', color: 'low', emoji: 'üü¢' };
            } else if (probability < 0.60) {
                return { category: 'MODERADO', color: 'medium', emoji: 'üü°' };
            } else {
                return { category: 'ALTO', color: 'high', emoji: 'üî¥' };
            }
        }

        function getRecommendations(riskCategory) {
            const recommendations = {
                'BAIXO': {
                    tc: 'TC de T√≥rax: 3 e 6 meses',
                    profilaxia: 'N√£o indicada'
                },
                'MODERADO': {
                    tc: 'TC de T√≥rax: 2, 4 e 6 meses',
                    profilaxia: 'Considerar'
                },
                'ALTO': {
                    tc: 'TC de T√≥rax: 1, 2, 4 e 6 meses',
                    profilaxia: 'Prednisona 20 mg/dia por 2 semanas'
                }
            };
            return recommendations[riskCategory] || recommendations['BAIXO'];
        }

        function createDosimetricChart(v5, v10, v20, v30, dpm, ratio) {
            const ctx = document.getElementById('dosimetricChart');
            
            // Destruir gr√°fico anterior se existir
            if (window.dosimetricChartInstance) {
                window.dosimetricChartInstance.destroy();
            }

            window.dosimetricChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['V5', 'V10', 'V20', 'V30', 'DPM (√∑10)', 'V5/V20 (√ó10)'],
                    datasets: [{
                        label: 'Valores Dosim√©tricos',
                        data: [v5, v10, v20, v30, dpm / 10, ratio * 10],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(255, 159, 64, 0.7)',
                            'rgba(255, 206, 86, 0.7)',
                            'rgba(75, 192, 192, 0.7)',
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(153, 102, 255, 0.7)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(255, 159, 64, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(153, 102, 255, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        title: {
                            display: true,
                            text: 'Gr√°fico de Par√¢metros Dosim√©tricos'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Valores (%)'
                            }
                        }
                    }
                }
            });
        }

        function calcularRisco() {
            if (!validateInputs()) {
                return;
            }

            const data = {
                age: parseFloat(document.getElementById('age').value),
                fev1: parseFloat(document.getElementById('fev1').value),
                imc: parseFloat(document.getElementById('imc').value),
                location: parseInt(document.getElementById('location').value),
                smoking: parseInt(document.getElementById('smoking').value),
                v5: parseFloat(document.getElementById('v5').value),
                v10: parseFloat(document.getElementById('v10').value),
                v20: parseFloat(document.getElementById('v20').value),
                v30: parseFloat(document.getElementById('v30').value),
                dpm: parseFloat(document.getElementById('dpm').value),
                vs5: parseFloat(document.getElementById('vs5').value)
            };

            const logOdds = calculateLogOdds(data);
            const probability = logisticFunction(logOdds);
            const riskCategory = classifyRisk(probability);
            const v5_v20_ratio = data.v20 > 0 ? data.v5 / data.v20 : 0;
            const recommendations = getRecommendations(riskCategory.category);

            // Atualizar resultado
            const percentProbability = Math.round(probability * 100);
            
            document.getElementById('riskIcon').textContent = riskCategory.emoji;
            document.getElementById('riskIcon').className = `risk-icon ${riskCategory.color}`;
            document.getElementById('resultTitle').textContent = `Risco ${riskCategory.category}`;
            document.getElementById('resultSubtitle').textContent = `${percentProbability}% de probabilidade`;

            const probabilityFill = document.getElementById('probabilityFill');
            probabilityFill.style.width = percentProbability + '%';
            probabilityFill.className = `probability-fill ${riskCategory.color}`;
            document.getElementById('probabilityText').textContent = percentProbability + '%';

            document.getElementById('riskCategory').textContent = riskCategory.category;
            document.getElementById('ratioDisplay').textContent = v5_v20_ratio.toFixed(2);

            // Adicionar badge de risco
            const badgeDiv = document.getElementById('riskBadge');
            badgeDiv.innerHTML = `<div class="risk-badge ${riskCategory.color}">${riskCategory.category}</div>`;

            // Mostrar nome do paciente se preenchido
            const patientName = document.getElementById('patientName').value;
            if (patientName) {
                document.getElementById('patientDisplay').textContent = `Paciente: ${patientName}`;
                document.getElementById('patientDisplay').style.display = 'block';
            } else {
                document.getElementById('patientDisplay').style.display = 'none';
            }

            const recommendationsContent = document.getElementById('recommendationsContent');
            recommendationsContent.innerHTML = `
                <div style="margin-bottom: 20px; padding: 15px; background: white; border-radius: 8px; border-left: 4px solid; border-left-color: ${riskCategory.color === 'low' ? '#28a745' : riskCategory.color === 'medium' ? '#ffc107' : '#dc3545'}; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <div style="margin-bottom: 12px;">
                        <div style="font-size: 12px; color: #999; text-transform: uppercase; margin-bottom: 4px;">TC de T√≥rax</div>
                        <div style="font-size: 16px; font-weight: 600; color: #333;">${recommendations.tc}</div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #999; text-transform: uppercase; margin-bottom: 4px;">Profilaxia</div>
                        <div style="font-size: 16px; font-weight: 600; padding: 10px 12px; border-radius: 6px; background: ${riskCategory.color === 'low' ? '#d4edda' : riskCategory.color === 'medium' ? '#fff3cd' : '#f8d7da'}; color: ${riskCategory.color === 'low' ? '#155724' : riskCategory.color === 'medium' ? '#856404' : '#721c24'};">${recommendations.profilaxia}</div>
                    </div>
                </div>
            `;

            // Criar gr√°fico
            createDosimetricChart(data.v5, data.v10, data.v20, data.v30, data.dpm, v5_v20_ratio);

            document.getElementById('resultSection').classList.add('show');
            document.getElementById('btnPdf').style.display = 'inline-block';
            document.getElementById('errorMessage').classList.remove('show');
        }

        function downloadPDF() {
            const result = document.getElementById('resultSection');
            if (!result || !result.classList.contains('show')) {
                alert('Calcule o risco antes de gerar o PDF.');
                return;
            }

            window.print();
        }

        function resetForm() {
            document.getElementById('calculatorForm').reset();
            document.getElementById('resultSection').classList.remove('show');
            const btnPdf = document.getElementById('btnPdf');
            if (btnPdf) btnPdf.style.display = 'none';
            document.getElementById('ratioValue').textContent = '0.00';
            document.getElementById('vs5AutoValue').textContent = '0.00';
            document.getElementById('errorMessage').classList.remove('show');
            if (window.dosimetricChartInstance) {
                window.dosimetricChartInstance.destroy();
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
        }
    </script>
</body>
</html>
